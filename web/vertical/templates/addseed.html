{% load static %}
{% load staticfiles %}

<!DOCTYPE html>
<html lang="zh-CN" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="{{ STATIC_URL }} /static/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="container">
    <h1>添加种子数据</h1>
    <!--输入框-->
    <!--<form>-->
    <!--<div class="form-group row">-->
    <!--<label for="first_name" class="col-xs-3 col-form-label mr-2">First Name</label>-->
    <!--<div class="col-xs-9">-->
    <!--<input type="text" class="form-control" id="first_name" name="first_name">-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="form-group row">-->
    <!--<label for="last_name" class="col-xs-3 col-form-label mr-2">Last Name</label>-->
    <!--<div class="col-xs-9">-->
    <!--<input type="text" class="form-control" id="last_name" name="last_name">-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="form-group row">-->
    <!--<div class="offset-xs-3 col-xs-9">-->
    <!--<button type="submit" class="btn btn-primary">Submit</button>-->
    <!--</div>-->
    <!--</div>-->
    <!--</form>-->
    <div class="page-actions">
        <ul class="page-action">
            <li class="action">
                <div class="action-name">
                    <span>名称</span>
                    <input class="input-group-sm" value="">
                </div>
                <div class="action-next">
                    <span>next</span>
                    <ul class="page-next-action">
                        <div class="next-type">
                            <span>type</span>
                            <select>
                                <option value="xpath">xpath</option>
                                <option value="json">json</option>
                                <option value="re">re</option>
                            </select>
                        </div>
                        <div class="next-temp">
                            <span>URL 模板</span>
                            <input class="input-group-sm" value="">
                        </div>
                    </ul>
                </div>
                <div class="action-extract">
                    <span>提取</span>
                    <textarea rows="3" class="input-group-sm" style="white-space:nowrap; overflow:scroll;"
                              required></textarea>
                </div>
                <div class="action-sample">
                    <span>示例链接</span>
                    <textarea rows="3" class="input-group-sm" style="white-space:nowrap; overflow:scroll;" required
                              autofocus></textarea>
                </div>
                <div class="action-remove-self">删除自己</div>
                <div class="action-add-child">添加子节点</div>
            </li>
        </ul>
        <ul class="page-action">
            <li class="action">
                <div class="action-name">
                    <span>名称</span>
                    <input class="input-group-sm" value="">
                </div>
                <div class="action-next">
                    <span>next</span>
                    <ul class="page-next-action">
                        <div class="next-type">
                            <span>type</span>
                            <select>
                                <option value="xpath">xpath</option>
                                <option value="json">json</option>
                                <option value="re">re</option>
                            </select>
                        </div>
                        <div class="next-temp">
                            <span>URL 模板</span>
                            <input class="input-group-sm" value="">
                        </div>
                    </ul>
                </div>
                <div class="action-extract">
                    <span>提取</span>
                    <textarea rows="3" class="input-group-sm" style="white-space:nowrap; overflow:scroll;"
                              required></textarea>
                </div>
                <div class="action-sample">
                    <span>示例链接</span>
                    <textarea rows="3" class="input-group-sm" style="white-space:nowrap; overflow:scroll;" required
                              autofocus></textarea>
                </div>
                <div class="action-remove-self">删除自己</div>
                <div class="action-add-child">添加子节点</div>
            </li>
        </ul>
    </div>

    <div class="addPagesField"><i class="fa fa-plus"></i>添加 Page Action</div>
    <div class="test-parse-data"><i class="fa fa-plus"></i>测试提取数据</div>
</div>

<script type="text/javascript" src="{{ STATIC_URL }}/static/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}/static/js/bootstrap.js"></script>
    
<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>

<script>
    var temp_data = '<ul id="addPages" class="page-action">\n' +
        '        <li>\n' +
        '            <div class="page-name">\n' +
        '                <span>名称</span>\n' +
        '                <input class="input-group-sm">\n' +
        '            </div>\n' +
        '            <div class="page-next">\n' +
        '                <span>next</span>\n' +
        '                <ul class="page-next-action">\n' +
        '                    <div class="next-type">\n' +
        '                        <span>type</span>\n' +
        '                        <select>\n' +
        '                            <option value="xpath">xpath</option>\n' +
        '                            <option value="json">json</option>\n' +
        '                            <option value="re">re</option>\n' +
        '                        </select>\n' +
        '                    </div>\n' +
        '                    <div class="next-temp">\n' +
        '                        <span>URL 模板</span>\n' +
        '                        <input class="input-group-lg col-lg-7">\n' +
        '                    </div>\n' +
        '                </ul>\n' +
        '            </div>\n' +
        '            <div class="page-extract">\n' +
        '                <span>提取</span>\n' +
        '                <textarea rows="3" class="col-lg-7" style="white-space:nowrap; overflow:scroll;" required></textarea>\n' +
        '            </div>\n' +
        '            <div class="page-sample">\n' +
        '                <span>示例链接</span>\n' +
        '                <textarea rows="3" class="col-lg-7" style="white-space:nowrap; overflow:scroll;" required\n' +
        '                          autofocus></textarea>\n' +
        '            </div>\n' +
        '            <div class="remove-gc-field">删除自己</div>\n' +
        '            <div class="add-gc-field">添加子节点</div>\n' +
        '        </li>\n' +
        '    </ul>';

    $(".addPagesField").click(function () {
        $('#addPages').append(temp_data)
    });


    $(document).on('click', ".add-gc-field", function (event) {
        $(this).append(temp_data);
        event.stopPropagation()
    });

    $(document).on('click', ".remove-gc-field", function (event) {
        $(this).parent().parent().remove();
        event.stopPropagation()
    });

    $(".test-parse-data").click(function () {
        var page_actions = $(".page-actions"); // 获取到跟节点 page-actions

        var page_action_list = page_actions.children('.page-action'); // 获取到第一层的 page-action 列表
        var add_page_datas = [];
        parse_page_action_list(page_action_list, add_page_datas);
        console.log(add_page_datas);
        // page_action_list.each(function (i, n) {  // 遍历第一层的列表
        //     var obj = $(n);
        //     var action = obj.find('.action');
        //     var action_name = action.find('.action-name');
        //     console.log(action_name);
        //     var action_name_value = action_name.find('input').val();
        //     console.log(action_name_value)
        // })
    });

    function parse_page_action_list(page_action_list, add_page_datas) {
        page_action_list.each(function (i, n) {  // 遍历子节点，获取输入数据
            var data = {};
            var obj = $(n);
            var action = obj.find('.action');
            var action_name = action.find('.action-name');
            console.log(action_name);
            var action_name_value = action_name.find('input').val();
            console.log(action_name_value);
            data['action_name'] = action_name_value;
            add_page_datas.push(data)
        })
    }
</script>
</body>
</html>